language: generic
sudo: required

notifications:
  email:
    recipients:
      - paul@myitcv.io
    on_success: change
    on_failure: always

matrix:
  include:
    - env: CHROMEDRIVER_VERSION=2.40 CHROME_CHANNEL=beta GO_VERSION=go1.10.3
    - env: CHROMEDRIVER_VERSION=2.40 CHROME_CHANNEL=beta GO_VERSION=12d0a2884a9e1a12050807393fe0266d1b0b40fd GO111MODULE=on

services:
  - docker

before_install:
  - docker --version
  - source .docker_details
  - docker pull $DOCKER_IMAGE:$CHROME_CHANNEL | tee
  - cat Dockerfile.user | envsubst '$CHROME_CHANNEL' | docker build -t $(basename $DOCKER_IMAGE) --build-arg USER=$USER --build-arg UID=$UID --build-arg DOCKER_WORKING_DIR=$DOCKER_WORKING_DIR -

script:
  - docker run -u $USER:$USER --env-file .docker_env_file -v $PWD:$DOCKER_WORKING_DIR -w $DOCKER_WORKING_DIR --rm $(basename $DOCKER_IMAGE) ./_scripts/docker_run.sh
